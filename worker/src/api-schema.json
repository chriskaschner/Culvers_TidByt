{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "schema_version": 1,
  "description": "Machine-readable contract for Custard Calendar Worker API v1. Bump schema_version on any breaking change to a required field.",
  "endpoints": {
    "/api/v1/flavors": {
      "method": "GET",
      "params": { "slug": "store slug (required)" },
      "response": {
        "type": "object",
        "required": ["name", "flavors"],
        "properties": {
          "name": { "type": "string" },
          "flavors": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["title", "date"],
              "properties": {
                "title": { "type": "string" },
                "date": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$" },
                "description": { "type": ["string", "null"] }
              }
            }
          }
        }
      }
    },
    "/api/v1/today": {
      "method": "GET",
      "params": { "slug": "store slug (required)" },
      "response": {
        "type": "object",
        "required": ["store", "slug", "brand", "date", "flavor"],
        "properties": {
          "store": { "type": "string" },
          "slug": { "type": "string" },
          "brand": { "type": "string" },
          "date": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$" },
          "flavor": { "type": ["string", "null"] },
          "description": { "type": ["string", "null"] },
          "rarity": {
            "type": ["object", "null"],
            "properties": {
              "appearances": { "type": "integer" },
              "avg_gap_days": { "type": ["integer", "null"] },
              "label": { "type": ["string", "null"] }
            }
          },
          "spoken": { "type": "string" },
          "spoken_verbose": { "type": "string" }
        }
      }
    },
    "/api/v1/stores": {
      "method": "GET",
      "params": { "q": "search query, min 2 chars (required)" },
      "response": {
        "type": "object",
        "required": ["stores"],
        "properties": {
          "stores": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["slug", "name"],
              "properties": {
                "slug": { "type": "string" },
                "name": { "type": "string" },
                "brand": { "type": "string" },
                "city": { "type": "string" },
                "state": { "type": "string" }
              }
            }
          }
        }
      }
    }
  }
}
